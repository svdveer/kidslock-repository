<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/style.css">
    <title>KidsLock</title>
</head>
<body>
    <div class="container-main">
        <h1 class="title">KidsLock</h1>
        {% for tv in tvs %}
        <div class="family-card">
            <div class="card-header">
                <div class="user-block">
                    <div class="avatar">{{ tv.name[0] }}</div>
                    <span class="user-name">{{ tv.name }}</span>
                </div>
                <div class="bedtime-tag">ğŸŒ™ {{ tv.bedtime }}</div>
            </div>
            <div class="time-main">
                <div class="time-value">{% if tv.no_limit %}âˆ{% else %}{{ tv.remaining }}{% endif %}</div>
                <div class="time-label">minuten resterend</div>
            </div>
            {% if not tv.no_limit %}
            <div class="progress-wrap">
                {% set pct = (tv.elapsed / tv.limit * 100) | int %}
                <div class="progress-bg">
                    <div class="progress-fill" style="width: {{ pct if pct < 100 else 100 }}%;"></div>
                </div>
            </div>
            {% endif %}
            <div class="btn-grid">
                <button class="btn btn-lock" onclick="tvAction('{{ tv.ip }}', 'lock')">Vergrendel ğŸ”’</button>
                <button class="btn btn-sub" onclick="tvAction('{{ tv.ip }}', 'unlock')">Openen</button>
                <button class="btn btn-sub" onclick="tvAction('{{ tv.ip }}', 'reset')">Reset</button>
                <button class="btn btn-bonus" onclick="tvAction('{{ tv.ip }}', '+15')">+15m</button>
                <button class="btn btn-bonus" onclick="tvAction('{{ tv.ip }}', '+30')">+30m</button>
            </div>
        </div>
        {% endfor %}
        <div class="footer-nav"><a href="settings">âš™ï¸ Instellingen</a></div>
    </div>
    <script>
        function tvAction(ip, act) {
            const fd = new FormData(); fd.append('ip', ip); fd.append('action', act);
            fetch('api/tv_action', { method: 'POST', body: fd }).then(() => setTimeout(() => location.reload(), 400));
        }
    </script>
</body>
</html>